<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" /><title> Super Cat </title>
<script
src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
<style type="text/css"> body { margin: 0; }</style>
</head>
<body>
<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 1000, height: 650,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 1500 },
                debug: true
        }},
        scene: {preload: preload, create: create, update: update }
    };

    new Phaser.Game(config);

    function preload(){

        // Ce que j'ai rajouté :

        this.load.spritesheet('SpriteFire','Assets/Assets_plateformes/SpriteFire.png',
            { frameWidth: 32, frameHeight: 32 });

        //********************************

        this.load.image("background", "Assets/City.png");
        this.load.image("feu", "Assets/Assets_plateformes/FIRE-sheet.png")
        this.load.image("collectibles", "Assets/Assets_plateformes/Collectibles.png")
        this.load.image("barrieres", "Assets/Barrieres.png")
        this.load.image("Phaser_assets", "Assets/Assets_plateformes/Plateformes_1.png");
        this.load.tilemapTiledJSON("carte", "Assets/Map_1.json");
        this.load.spritesheet('perso','Assets/cat.png',
        { frameWidth: 32, frameHeight: 32});
    
    }

    var cursurs ;
    var gameOver ;
    var healthpoint;

    gameOver= false;
    sens = 1;

    function create (){
        this.add.image(800,800,"background");

        const carteDuNiveau = this.add.tilemap("carte");

        const tileset = carteDuNiveau.addTilesetImage(
          "Plateformes",
          "Phaser_assets"
        );
        const Plateformes = carteDuNiveau.createLayer(
          "plateformes",
          tileset
        );


        // Ce que j'ai rajouté :

        this.fire = this.physics.add.group({ allowGravity : false, collideWorldBounds: true})

        // Et je viens créer mes sous-dossier qui seront rangés dans le groupe "fire" puisque j'utilise " this.fire.create "


        //Level 1
        
        
        this.SpriteFireUn = this.fire.create(432, 400, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(464, 400, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(496, 400, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(720, 400, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(752, 400, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(912, 400, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(944, 400, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1104, 400, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1136, 400, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1296, 400, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1328, 400, 'SpriteFire');
        
        //Level 2
        
        this.SpriteFireUn = this.fire.create(1488, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1456, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1424, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1392, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1296, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1264, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1168, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1104, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1008, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(976, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(848, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(880, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(720, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(688, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(624, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(560, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(464, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(496, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(400, 1600, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(176, 1600, 'SpriteFire');
    
        //Level 3
        this.SpriteFireUn = this.fire.create(496,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(528,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(560,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(592,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(624,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(656,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(688,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(720,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(752,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(784,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(816,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(848,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(880,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(912,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(944,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(976,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1008,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1040,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1072,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1104,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1136,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1168,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1200,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1232,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1264,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1296,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1328,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1360,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(1392,1264, 'SpriteFire');
        this.SpriteFireUn = this.fire.create(600,600, 'SpriteFire');


        this.SpriteFireInvertTrois = this.fire.create(464, 496, 'SpriteFire');
            this.SpriteFireInvertTrois.setFlipY(true);
        this.SpriteFireInvertTrois = this.fire.create(496, 496, 'SpriteFire');
            this.SpriteFireInvertTrois.setFlipY(true);
        this.SpriteFireInvertTrois = this.fire.create(496, 624, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 656, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 688, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 720, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 752, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 784, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 816, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 848, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 880, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 912, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 944, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 976, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;
        this.SpriteFireInvertTrois = this.fire.create(496, 1008, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = -90;

            this.SpriteFireInvertTrois = this.fire.create(368, 624, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 656, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 688, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 720, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 752, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 784, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 816, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 848, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 880, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 912, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 944, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 976, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;
        this.SpriteFireInvertTrois = this.fire.create(368, 1008, 'SpriteFire');
            this.SpriteFireInvertTrois.angle = 90;







        //********************************





        Plateformes.setCollisionByProperty({ estSolide: true });
        
        this.player = this.physics.add.sprite(600,600, 'perso').setSize(20,20).setOffset(5,12); //*spawn 0.300
        this.player.setCollideWorldBounds(true);   
        this.physics.add.collider(this.player, Plateformes);
        this.physics.world.setBounds(0, 0, 1600, 1600); 
        this.cameras.main.setBounds(0, 0, 1600, 1600);
        this.cameras.main.zoom = 2;
        this.cameras.main.startFollow(this.player);

        

        // Ce que j'ai rajouté :

        this.anims.create({
            key: 'SpriteFire',
            frames: this.anims.generateFrameNumbers('SpriteFire', {start:0,end:5}),
            frameRate: 4,
            repeat: -1
        })

        //********************************


        this.anims.create({
        key: 'left',
        frames: this.anims.generateFrameNumbers('perso', {start:5,end:7}),
        frameRate: 4,
        repeat: -1
        });

        this.anims.create({
        key: 'turn',
        frames: [ { key: 'perso', frame: 8 } ],
        frameRate: 10
        });

        this.anims.create({
        key: 'up-right',
        frames: [ { key: 'perso', frame: 13 } ],
        frameRate: 10
        });

        this.anims.create({
        key: 'up-left',
        frames: [ { key: 'perso', frame: 1 } ],
        frameRate: 10
        });

        this.anims.create({
        key: 'onWallL',
        frames: [ { key: 'perso', frame: 0 } ],
        frameRate: 10
        });
        this.anims.create({
        key: 'onWallR',
        frames: [ { key: 'perso', frame: 16 } ],
        frameRate: 10
        });

        this.anims.create({
        key: 'right',
        frames: this.anims.generateFrameNumbers('perso', {start:11,end:13}),
        frameRate: 4,
        repeat: -1
        });


        this.clavier = this.input.keyboard.createCursorKeys();
        this.clavier = this.input.keyboard.addKeys('S,Q,D,SPACE');
        scoreText=this.add.text(16,16,'score: 0',{fontSize:'32px',fill:'#000'});
        this.add.image(800,800,"barrieres");
    
    }

    walljump=false

    function update(){

// Ce que j'ai rajouté :        

    // Animation - Feu
    // Pour chaque objet faisant partie de mon groupe 'Feu', je lui indique d'effectuer l'animation 'SpriteFire' au travers d'une fonction
        this.fire.children.each(function(SpriteFire) {
            SpriteFire.anims.play("SpriteFire", true)
            }, this);

//********************************






        if (gameOver){return;}
        
        if (this.clavier.Q.isDown && !this.onWallGauche && !walljump){ //si la touche gauche est appuyée
        

            this.player.setVelocityX(-160); //alors vitesse négative en X
            this.player.anims.play('left', true); //et animation => gauche

        
        
        }

        else if (this.onWallGauche && this.clavier.SPACE.isDown){
            walljump=true;
            this.player.setVelocityY(-500);
            this.player.setVelocityX(300); //alors vitesse positive en X
            this.player.anims.play('right', true);
            this.onWallGauche=false;
            setTimeout(() => {
                walljump=false;
            }, 300);
        
        
        }

        else if (this.clavier.D.isDown && !this.onWallDroit && !walljump){ //sinon si la touche droite est appuyée
            this.player.setVelocityX(160); //alors vitesse positive en X
            this.player.anims.play('right', true); //et animation => droite
        }


        else if (this.onWallDroit && this.clavier.SPACE.isDown){
            walljump=true;
            this.player.setVelocityY(-500);
            this.player.setVelocityX(-300); //alors vitesse positive en X
            this.player.anims.play('left', true);
            this.onWallDroit=false;
            setTimeout(() => {
                walljump=false;
            }, 300);
        
        
        }

        else if (!walljump){ // sinon
            this.player.setVelocityX(0); //vitesse nulle
            this.player.anims.play('turn'); //animation fait face caméra
        }
        setTimeout(() => {
            this.onWall=false;
        
        }, 3000);


        //lien anim https://stackabuse.com/phaser-3-and-tiled-building-a-platformer/


        if (this.clavier.SPACE.isDown && this.player.body.blocked.down){
            //si touche haut appuyée ET que le perso touche le sol
            this.player.setVelocityY(-500); //alors vitesse verticale négative

            // hero can't jump anymore
            this.canJump = false;
        
            // hero is not on the wall anymore
            this.onWallDroit = false;
            this.onWallGauche = false;
        
        
        
        
        }

        if (this.clavier.S.isDown && !this.player.body.touching.down){ //si la touche bas est appuyée en saut
            this.player.setVelocityY(450); 
        } 

        if(this.player.body.blocked.down){
        
            // hero can jump
            this.canJump = true;
        
            // hero not on the wall
            this.onWallDroit = false;
            this.onWallGauche = false;
        }



        if(this.player.body.blocked.right && !this.player.body.blocked.down){
        
            this.onWallDroit = true;
        }



        if(this.player.body.blocked.left && !this.player.body.blocked.down){
            this.onWallGauche = true;

        }


        }



        function playerHit1(){
        console.log("touché violet !")


    }
</script>
</body>
</html>